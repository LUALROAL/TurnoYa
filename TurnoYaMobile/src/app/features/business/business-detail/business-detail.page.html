<ion-header class="ion-no-border">
  <ion-toolbar class="transparent-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/business/list" color="light"></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <!-- Owner Options Actions -->
      @if (isOwner) {
      <ion-button (click)="presentOwnerActionSheet()">
        <ion-icon slot="icon-only" name="ellipsis-vertical" color="light"></ion-icon>
      </ion-button>
      }
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  @if (isLoading) {
  <div class="t-page t-flex-col t-justify-center t-items-center" style="height: 100%">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p class="t-body t-mt-4">Cargando detalles...</p>
  </div>
  }

  @if (!isLoading && business) {
  <!-- Hero Section (Full width top) -->
  <div class="hero-section">
    <div class="hero-content t-page">
      <div class="category-badge">{{ business.category }}</div>
      <h1 class="t-h1 text-white t-mt-2">{{ business.name }}</h1>

      <div class="t-flex-row t-mt-2 text-white-alpha">
        <ion-icon name="location"></ion-icon>
        <span class="t-body" style="color: rgba(255,255,255,0.9)">
          {{ business.city || 'Ubicación no especificada' }}
        </span>
      </div>

      @if (business.averageRating > 0) {
      <div class="hero-rating t-mt-2">
        <ion-icon name="star"></ion-icon>
        <span>{{ business.averageRating | number:'1.1-1' }}</span>
      </div>
      }
    </div>
  </div>

  <!-- Main Content (Overlapping Hero) -->
  <div class="detail-content t-page">

    <!-- Info Card -->
    <div class="t-card info-card">
      <h2 class="t-h3">Sobre Nosotros</h2>
      <p class="t-body t-mb-4">{{ business.description || 'Sin descripción disponible.' }}</p>

      <div class="info-grid">
        @if (business.address) {
        <div class="info-item">
          <div class="icon-box">
            <ion-icon name="map"></ion-icon>
          </div>
          <div>
            <label>Dirección</label>
            <p>{{ business.address }}</p>
          </div>
        </div>
        }

        @if (business.phone) {
        <div class="info-item">
          <div class="icon-box">
            <ion-icon name="call"></ion-icon>
          </div>
          <div>
            <label>Teléfono</label>
            <p>{{ business.phone }}</p>
          </div>
        </div>
        }

        @if (business.email) {
        <div class="info-item">
          <div class="icon-box">
            <ion-icon name="mail"></ion-icon>
          </div>
          <div>
            <label>Email</label>
            <p class="text-truncate">{{ business.email }}</p>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Services List -->
    <h2 class="t-h2 t-mt-6">Servicios</h2>

    @if (business.services && business.services.length > 0) {
    <div class="t-grid">
      @for (service of business.services; track service.id) {
      <div class="t-card service-card">
        <div class="t-flex-row t-justify-between t-mb-1">
          <span class="service-price">${{ service.price }}</span>
          <span class="service-duration">{{ service.duration }} min</span>
        </div>
        <h3 class="t-h3">{{ service.name }}</h3>
        @if (service.description) {
        <p class="t-caption t-mt-1">{{ service.description }}</p>
        }
        <ion-button expand="block" class="t-mt-3" fill="outline" size="small">
          Reservar
        </ion-button>
      </div>
      }
    </div>
    } @else {
    <div class="t-card t-flex-col t-items-center t-py-8">
      <ion-icon name="albums-outline" style="font-size: 32px; color: var(--t-text-tertiary);"></ion-icon>
      <p class="t-body t-mt-2">No hay servicios disponibles.</p>
    </div>
    }

    <!-- Bottom Action Bar (Floating) -->
    <div class="floating-action-bar">
      <ion-button expand="block" size="large" (click)="bookAppointment()">
        Agendar Cita
      </ion-button>
    </div>

  </div>
  }
</ion-content>
