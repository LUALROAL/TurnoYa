<ion-content class="form-bg" [fullscreen]="true">
  <div class="bg-decoration" aria-hidden="true">
    <div class="bg-orb orb-top"></div>
    <div class="bg-orb orb-bottom"></div>
  </div>

  <div class="form-wrap">
    <header class="form-header glass-panel">
      <ion-button fill="clear" (click)="onCancel()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
      <div>
        <p class="header-overline">Servicio</p>
        <h1>{{ isEditMode ? 'Editar Servicio' : 'Crear Servicio' }}</h1>
      </div>
    </header>

    @if (loading) {
      <article class="form-card glass-panel skeleton">
        <div class="skeleton-content"></div>
      </article>
    } @else {
      <form [formGroup]="serviceForm" (ngSubmit)="onSave()">
        <section class="form-section">
          <div class="section-head">
            <h2>Información Básica</h2>
            <p>Datos que verá el cliente al reservar</p>
          </div>

          <div class="form-card glass-panel">
            <div class="form-field">
              <label for="name">Nombre del servicio <span class="required">*</span></label>
              <ion-input
                id="name"
                type="text"
                formControlName="name"
                placeholder="Ej: Corte de cabello"
                [class.invalid]="formControls['name'].touched && formControls['name'].invalid"
              ></ion-input>
              @if (formControls['name'].touched && formControls['name'].invalid) {
                <span class="error-msg">{{ getErrorMessage('name') }}</span>
              }
            </div>

            <div class="form-field">
              <label for="description">Descripción <span class="field-hint">(Opcional)</span></label>
              <ion-textarea
                id="description"
                formControlName="description"
                rows="4"
                placeholder="Describe qué incluye este servicio"
              ></ion-textarea>
            </div>

            <div class="form-grid-2">
              <div class="form-field">
                <label for="price">Precio <span class="required">*</span></label>
                <ion-input
                  id="price"
                  type="number"
                  step="0.01"
                  min="0"
                  formControlName="price"
                  placeholder="Ej: 35000"
                  [class.invalid]="formControls['price'].touched && formControls['price'].invalid"
                ></ion-input>
                @if (formControls['price'].touched && formControls['price'].invalid) {
                  <span class="error-msg">{{ getErrorMessage('price') }}</span>
                }
              </div>

              <div class="form-field">
                <label for="duration">Duración (min) <span class="required">*</span></label>
                <ion-input
                  id="duration"
                  type="number"
                  min="5"
                  step="5"
                  formControlName="duration"
                  placeholder="Ej: 45"
                  [class.invalid]="formControls['duration'].touched && formControls['duration'].invalid"
                ></ion-input>
                @if (formControls['duration'].touched && formControls['duration'].invalid) {
                  <span class="error-msg">{{ getErrorMessage('duration') }}</span>
                }
              </div>
            </div>
          </div>
        </section>

        <section class="form-section">
          <div class="section-head">
            <h2>Condiciones</h2>
            <p>Configura anticipos y estado del servicio</p>
          </div>

          <div class="form-card glass-panel">
            <div class="form-field checkbox-field">
              <ion-checkbox id="requiresDeposit" formControlName="requiresDeposit"></ion-checkbox>
              <label for="requiresDeposit">
                Requiere anticipo
                <span class="field-hint">Solicita un pago parcial para confirmar la reserva</span>
              </label>
            </div>

            <div class="form-field">
              <label for="depositAmount">
                Valor anticipo
                <span class="field-hint">(Obligatorio si activas anticipo)</span>
              </label>
              <ion-input
                id="depositAmount"
                type="number"
                step="0.01"
                min="0"
                formControlName="depositAmount"
                placeholder="Ej: 10000"
              ></ion-input>
            </div>

            @if (isEditMode) {
              <div class="form-field checkbox-field">
                <ion-checkbox id="isActive" formControlName="isActive"></ion-checkbox>
                <label for="isActive">
                  Servicio activo
                  <span class="field-hint">Visible para los clientes en el catálogo</span>
                </label>
              </div>
            }
          </div>
        </section>

        <div class="form-actions">
          <ion-button type="button" fill="outline" expand="block" (click)="onCancel()" [disabled]="saving">
            Cancelar
          </ion-button>
          <ion-button type="submit" expand="block" class="button-primary" [disabled]="saving">
            <ion-icon slot="start" name="save"></ion-icon>
            {{ saving ? 'Guardando...' : (isEditMode ? 'Actualizar Servicio' : 'Crear Servicio') }}
          </ion-button>
        </div>
      </form>
    }
  </div>
</ion-content>
